import{_ as s,c as a,o as n,a as l}from"./app.c4aa1f4f.js";const C=JSON.parse('{"title":"nodejs 爬虫彩票数据","description":"","frontmatter":{},"headers":[{"level":2,"title":"1、工具","slug":"_1、工具","link":"#_1、工具","children":[]},{"level":2,"title":"2、操作","slug":"_2、操作","link":"#_2、操作","children":[]}],"relativePath":"end/node/nodejs爬虫彩票数据.md","lastUpdated":1673364519000}'),o={name:"end/node/nodejs爬虫彩票数据.md"},p=l(`<h1 id="nodejs-爬虫彩票数据" tabindex="-1">nodejs 爬虫彩票数据 <a class="header-anchor" href="#nodejs-爬虫彩票数据" aria-hidden="true">#</a></h1><h2 id="_1、工具" tabindex="-1">1、工具 <a class="header-anchor" href="#_1、工具" aria-hidden="true">#</a></h2><ul><li><a href="https://wendux.github.io/dist/#/doc/flyio/readme" target="_blank" rel="noreferrer">flyio</a> 请求库</li><li><a href="https://cheerio.js.org/" target="_blank" rel="noreferrer">cheerio</a> jquery 核心功能的一个快速灵活而又简洁的实现，主要是为了用在服务器端需要对 DOM 进行操作的地方</li><li><a href="https://github.com/ashtuchkin/iconv-lite" target="_blank" rel="noreferrer">iconv-lite</a> 转换字符编码</li></ul><h2 id="_2、操作" tabindex="-1">2、操作 <a class="header-anchor" href="#_2、操作" aria-hidden="true">#</a></h2><p>从彩票 500 网站上获取数据</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">http</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//kaijiang.500.com/shtml/dlt/19077.shtml</span></span>
<span class="line"></span></code></pre></div><p>可以看到只需要把彩种和对应期数处理下，就访问了对应的页面。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">fly</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">http://kaijiang.500.com/shtml/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">lotteryType</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">lotteryDate</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">.shtml</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">null,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">responseType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">stream</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  )</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">iconv</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">decode</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">gb2312</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">$</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cheerio</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">load</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">$</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">err</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>注意返回的类型要流的形式，先通过转 gb2312 编码解析，cheerio 在 load 后就获得一个文档结果，通过<code>$</code>可以去操作页面中的<code>DOM</code>了</p><p><a href="https://www.jianshu.com/p/629a81b4e013" target="_blank" rel="noreferrer">cheerio 中文文档</a></p><p>把需要的数据获取后，存入数据库。</p><p>然后 egg.js 的定时任务 <a href="https://github.com/eggjs/egg/blob/master/docs/source/zh-cn/basics/schedule.md" target="_blank" rel="noreferrer"><code>schedule</code></a>，在开奖时间后，每隔几分钟跑一次，获取最新的开奖数据。</p>`,12),e=[p];function t(r,c,y,D,F,i){return n(),a("div",null,e)}const d=s(o,[["render",t]]);export{C as __pageData,d as default};
