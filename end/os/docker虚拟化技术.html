<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>docker 虚拟化技术 | ZANTOP</title>
    <meta name="description" content="一切成功均源自积累!">
    <link rel="preload stylesheet" href="/assets/style.057e471f.css" as="style">
    <link rel="modulepreload" href="/assets/chunks/VPAlgoliaSearchBox.23e853b5.js">
    <link rel="modulepreload" href="/assets/app.c4aa1f4f.js">
    <link rel="modulepreload" href="/assets/end_os_docker虚拟化技术.md.30da5c24.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-93a960b4><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-93a960b4 data-v-0fa0e57d><div class="VPNavBar has-sidebar" data-v-0fa0e57d data-v-be450ad9><div class="container" data-v-be450ad9><div class="title" data-v-be450ad9><div class="VPNavBarTitle has-sidebar" data-v-be450ad9 data-v-6d2fb2d9><a class="title" href="/" data-v-6d2fb2d9><!--[--><!--]--><!----><!--[-->ZANTOP<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-be450ad9><div class="curtain" data-v-be450ad9></div><div class="content-body" data-v-be450ad9><!--[--><!--]--><div class="VPNavBarSearch search" data-v-be450ad9 style="--6d05f576:&#39;Meta&#39;;"><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-be450ad9 data-v-bdedfc22><span id="main-nav-aria-label" class="visually-hidden" data-v-bdedfc22>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-bdedfc22 data-v-96001b6b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-96001b6b><span class="text" data-v-96001b6b><!----> 前端 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-96001b6b><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-96001b6b><div class="VPMenu" data-v-96001b6b data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-a5bbb52c><a class="VPLink link" href="/front/js/%E6%95%B0%E7%BB%84%E6%96%B9%E6%B3%95" data-v-a5bbb52c data-v-30c06bd3><!--[-->javascript<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-a5bbb52c><a class="VPLink link" href="/front/ts/%E5%88%9D%E8%AF%86%E7%AF%87" data-v-a5bbb52c data-v-30c06bd3><!--[-->typescript<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-a5bbb52c><a class="VPLink link" href="/front/css/flex%E5%B8%83%E5%B1%80" data-v-a5bbb52c data-v-30c06bd3><!--[-->css<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-a5bbb52c><a class="VPLink link" href="/front/eng/git%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83" data-v-a5bbb52c data-v-30c06bd3><!--[-->工程化<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-a5bbb52c><a class="VPLink link" href="/front/interview/%E6%B1%87%E6%80%BB" data-v-a5bbb52c data-v-30c06bd3><!--[-->面试<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-bdedfc22 data-v-96001b6b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-96001b6b><span class="text" data-v-96001b6b><!----> 后端 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-96001b6b><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-96001b6b><div class="VPMenu" data-v-96001b6b data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-a5bbb52c><a class="VPLink link" href="/end/node/nestjs%E5%AE%9E%E8%B7%B5%E6%95%99%E7%A8%8B" data-v-a5bbb52c data-v-30c06bd3><!--[-->node<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-a5bbb52c><a class="VPLink link" href="/end/database/mongoose" data-v-a5bbb52c data-v-30c06bd3><!--[-->数据库<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-a5bbb52c><a class="VPLink link" href="/end/os/centos%E6%93%8D%E4%BD%9C" data-v-a5bbb52c data-v-30c06bd3><!--[-->服务器<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-bdedfc22 data-v-96001b6b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-96001b6b><span class="text" data-v-96001b6b><!----> 框架 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-96001b6b><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-96001b6b><div class="VPMenu" data-v-96001b6b data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-a5bbb52c><a class="VPLink link" href="/frame/react/redux%E7%9A%84%E5%AE%9E%E7%8E%B0" data-v-a5bbb52c data-v-30c06bd3><!--[-->react<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-a5bbb52c><a class="VPLink link" href="/frame/vue/vuex%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86" data-v-a5bbb52c data-v-30c06bd3><!--[-->vue<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-a5bbb52c><a class="VPLink link" href="/frame/flutter/%E5%9F%BA%E7%A1%80" data-v-a5bbb52c data-v-30c06bd3><!--[-->flutter<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/%E5%B8%B8%E7%94%A8" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->站点<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/read/%E6%8A%80%E6%9C%AF%E7%AE%A1%E7%90%8636%E8%AE%B2" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->读书<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/my/%E5%85%B3%E4%BA%8E" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->我的<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-be450ad9 data-v-da3f667a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-da3f667a data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-be450ad9 data-v-f38c483a data-v-96001b6b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-96001b6b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-96001b6b><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-96001b6b><div class="VPMenu" data-v-96001b6b data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-f38c483a><div class="item appearance" data-v-f38c483a><p class="label" data-v-f38c483a>Appearance</p><div class="appearance-action" data-v-f38c483a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-f38c483a data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-be450ad9 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-93a960b4 data-v-2817d72e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2817d72e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-2817d72e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-2817d72e>Menu</span></button><a class="top-link" href="#" data-v-2817d72e>Return to top</a></div><aside class="VPSidebar" data-v-93a960b4 data-v-c79ccefa><div class="curtain" data-v-c79ccefa></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-c79ccefa><span class="visually-hidden" id="sidebar-aria-label" data-v-c79ccefa> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-c79ccefa><section class="VPSidebarItem level-0 has-active" data-v-c79ccefa data-v-b05232f3><div class="item" role="button" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link" data-v-b05232f3 data-v-30c06bd3><!--[--><h2 class="text" data-v-b05232f3>服务器</h2><!--]--><!----></a><!----></div><div class="items" data-v-b05232f3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/end/os/centos%E6%93%8D%E4%BD%9C" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>centos操作</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/end/os/centos%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>centos问题总结</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/end/os/docker%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>docker虚拟化技术</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/end/os/Linux%E4%B8%8B%E5%AE%89%E8%A3%85Git" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Linux下安装Git</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/end/os/linux%E5%92%8Ccentos%E4%B8%ADchmod%E5%91%BD%E4%BB%A4" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>linux和centos中chmod命令</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/end/os/Mac%E4%B8%8Evim%E6%97%A5%E5%B8%B8%E5%91%BD%E4%BB%A4" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Mac与vim日常命令</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/end/os/Mac%E7%9B%B8%E5%85%B3" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Mac相关</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/end/os/ngnix%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>ngnix配置记录</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-93a960b4 data-v-0bd490fb><div class="VPDoc has-sidebar has-aside" data-v-0bd490fb data-v-c5936a1e><div class="container" data-v-c5936a1e><div class="aside" data-v-c5936a1e><div class="aside-curtain" data-v-c5936a1e></div><div class="aside-container" data-v-c5936a1e><div class="aside-content" data-v-c5936a1e><div class="VPDocAside" data-v-c5936a1e data-v-cdc66372><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-cdc66372 data-v-5dd9d5f6><div class="content" data-v-5dd9d5f6><div class="outline-marker" data-v-5dd9d5f6></div><div class="outline-title" data-v-5dd9d5f6>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-5dd9d5f6><span class="visually-hidden" id="doc-outline-aria-label" data-v-5dd9d5f6> Table of Contents for current page </span><ul class="root" data-v-5dd9d5f6 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-cdc66372></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-c5936a1e><div class="content-container" data-v-c5936a1e><!--[--><!--]--><main class="main" data-v-c5936a1e><div style="position:relative;" class="vp-doc _end_os_docker%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF" data-v-c5936a1e><div><h1 id="docker-虚拟化技术" tabindex="-1">docker 虚拟化技术 <a class="header-anchor" href="#docker-虚拟化技术" aria-hidden="true">#</a></h1><h2 id="_1、docker-与虚拟机" tabindex="-1">1、docker 与虚拟机 <a class="header-anchor" href="#_1、docker-与虚拟机" aria-hidden="true">#</a></h2><p>两张图比较 docker 与虚拟机的本质原理区别</p><p><img src="http://open.zantop.cn/docker1.png" alt=""></p><p><img src="http://open.zantop.cn/docker2.png" alt=""></p><p>更形象的对比：</p><p><strong>宿主机</strong><img src="https://pic1.zhimg.com/80/v2-2a05f6b780ea9692a459477bbda7b066_hd.jpg" alt=""></p><p><strong>虚拟机</strong><img src="https://pic4.zhimg.com/80/v2-a4bd3589de0a0536d73fd53f3403adff_hd.jpg" alt=""></p><p><strong>docker 容器</strong><img src="https://pic4.zhimg.com/80/v2-b9430887dc90820af97bb2d35854e34d_hd.jpg" alt=""></p><ol><li>docker 启动快速属于秒级别。虚拟机通常需要几分钟去启动。</li><li>docker 需要的资源更少，docker 在操作系统级别进行虚拟化，docker 容器和内核交互，几乎没有性能损耗，性能优于通过 Hypervisor 层与内核层的虚拟化。；</li><li>docker 更轻量，docker 的架构可以共用一个内核与共享应用程序库，所占内存极小。同样的硬件环境，Docker 运行的镜像数远多于虚拟机数量。对系统的利用率非常高</li><li>与虚拟机相比，docker 隔离性更弱，docker 属于进程之间的隔离，虚拟机可实现系统级别隔离；</li><li>安全性： docker 的安全性也更弱。Docker 的租户 root 和宿主机 root 等同，一旦容器内的用户从普通用户权限提升为 root 权限，它就直接具备了宿主机的 root 权限，进而可进行无限制的操作。虚拟机租户 root 权限和宿主机的 root 虚拟机权限是分离的，并且虚拟机利用如 Intel 的 VT-d 和 VT-x 的 ring-1 硬件隔离技术，这种隔离技术可以防止虚拟机突破和彼此交互，而容器至今还没有任何形式的硬件隔离，这使得容器容易受到攻击。</li><li>可管理性：docker 的集中化管理工具还不算成熟。各种虚拟化技术都有成熟的管理工具，例如 VMware vCenter 提供完备的虚拟机管理能力。</li><li>高可用和可恢复性：docker 对业务的高可用支持是通过快速重新部署实现的。虚拟化具备负载均衡，高可用，容错，迁移和数据保护等经过生产实践检验的成熟保障机制，VMware 可承诺虚拟机 99.999%高可用，保证业务连续性。</li><li>快速创建、删除：虚拟化创建是分钟级别的，Docker 容器创建是秒级别的，Docker 的快速迭代性，决定了无论是开发、测试、部署都可以节约大量时间。</li><li>交付、部署：虚拟机可以通过镜像实现环境交付的一致性，但镜像分发无法体系化；Docker 在 Dockerfile 中记录了容器构建过程，可在集群中实现快速分发和快速部署;</li></ol><p><strong>docker 的架构图如下</strong></p><p><img src="http://open.zantop.cn/docker.jpg" alt=""></p><p>从图中可以看出几个组成部分</p><ol><li>docker client: 即 docker 命令行工具</li><li>docker host: 宿主机，docker daemon 的运行环境服务器</li><li>docker daemon: docker 的守护进程，docker client 通过命令行与 docker daemon 交互</li><li>container: 最小型的一个操作系统环境，可以对各种服务以及应用容器化</li><li>image: 镜像，可以理解为一个容器的模板配置，通过一个镜像可以启动多个容器</li><li>registry: 镜像仓库，存储大量镜像，可以从镜像仓库拉取和推送镜像</li></ol><h2 id="_2、安装与卸载" tabindex="-1">2、安装与卸载 <a class="header-anchor" href="#_2、安装与卸载" aria-hidden="true">#</a></h2><p>卸载之前的就版本</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">sudo yum remove docker \</span></span>
<span class="line"><span style="color:#A6ACCD;">                  docker</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">client \</span></span>
<span class="line"><span style="color:#A6ACCD;">                  docker</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">client</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">latest \</span></span>
<span class="line"><span style="color:#A6ACCD;">                  docker</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">common \</span></span>
<span class="line"><span style="color:#A6ACCD;">                  docker</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">latest \</span></span>
<span class="line"><span style="color:#A6ACCD;">                  docker</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">latest</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">logrotate \</span></span>
<span class="line"><span style="color:#A6ACCD;">                  docker</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">logrotate \</span></span>
<span class="line"><span style="color:#A6ACCD;">                  docker</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">engine</span></span>
<span class="line"></span></code></pre></div><p>1、安装依赖</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">yum install </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">y yum</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">utils device</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">mapper</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">persistent</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">data lvm2</span></span>
<span class="line"></span></code></pre></div><p>2、添加镜像</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">//安装 docker 官方的镜像源</span></span>
<span class="line"><span style="color:#A6ACCD;">yum</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">manager </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">add</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">repo </span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//download.docker.com/linux/centos/docker-ce.repo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 如果在国内，安装阿里云的镜像</span></span>
<span class="line"><span style="color:#A6ACCD;">yum</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">manager </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">add</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">repo </span><span style="color:#FFCB6B;">http</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"></span></code></pre></div><p>3、安装 docker</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">yum install </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">y docker</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ce </span><span style="color:#676E95;font-style:italic;">//社区版</span></span>
<span class="line"><span style="color:#A6ACCD;">docker </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">version  </span><span style="color:#676E95;font-style:italic;">//查看版本信息</span></span>
<span class="line"><span style="color:#A6ACCD;">docker version  </span><span style="color:#676E95;font-style:italic;">//查看更详细的版本号信息</span></span>
<span class="line"><span style="color:#A6ACCD;">docker info  </span><span style="color:#676E95;font-style:italic;">//查看docker的详细配置信息</span></span>
<span class="line"></span></code></pre></div><p>4、加速配置</p><ul><li>阿里云（先加入阿里云开发者平台：<a href="https://dev.aliyun.com" target="_blank" rel="noreferrer">https://dev.aliyun.com</a>）</li><li>docker 中国加速器（<a href="https://www.docker" target="_blank" rel="noreferrer">https://www.docker</a>‐<a href="http://cn.com" target="_blank" rel="noreferrer">cn.com</a>)</li><li>USTC 加速器（<a href="https://lug.ustc.edu.cn/wiki/" target="_blank" rel="noreferrer">https://lug.ustc.edu.cn/wiki/</a> ）</li><li>daocloud</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">sudo vim </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">docker</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">daemon</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//配置内容：</span></span>
<span class="line"><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">registry‐mirrors</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://c7rydq9o.mirror.aliyuncs.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> sudo systemctl daemon‐reload</span></span>
<span class="line"><span style="color:#A6ACCD;"> sudo systemctl restart docker</span></span>
<span class="line"></span></code></pre></div><h2 id="_3、docker-基础" tabindex="-1">3、docker 基础 <a class="header-anchor" href="#_3、docker-基础" aria-hidden="true">#</a></h2><p>1、相关命令</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">service docker start                             </span><span style="color:#676E95;font-style:italic;">// 开启docker服务</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl start docker                           </span><span style="color:#676E95;font-style:italic;">// 启动 docker 后台服务</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl stop docker                            </span><span style="color:#676E95;font-style:italic;">//  停止docker 后台服务</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl restart docker                         </span><span style="color:#676E95;font-style:italic;">// 重启docker服务</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl status docker                          </span><span style="color:#676E95;font-style:italic;">// 查看docker运行状态</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl daemon</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">reload                          </span><span style="color:#676E95;font-style:italic;">// 重启docker守护进程</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//镜像操作</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">docker search jenkins                            </span><span style="color:#676E95;font-style:italic;">// docker搜索镜像</span></span>
<span class="line"><span style="color:#A6ACCD;">docker pull jenkins                              </span><span style="color:#676E95;font-style:italic;">// docker拉取镜像</span></span>
<span class="line"><span style="color:#A6ACCD;">docker images                                    </span><span style="color:#676E95;font-style:italic;">// 查看镜像列表</span></span>
<span class="line"><span style="color:#A6ACCD;">docker ps </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">a                                     </span><span style="color:#676E95;font-style:italic;">// 查看容器,不加-a查看正在运行的，加上-a查看所有容器</span></span>
<span class="line"><span style="color:#A6ACCD;">docker rm 容器id                                  </span><span style="color:#676E95;font-style:italic;">// 删除容器</span></span>
<span class="line"><span style="color:#A6ACCD;">docker rmi 镜像id                                 </span><span style="color:#676E95;font-style:italic;">// 删除镜像</span></span>
<span class="line"><span style="color:#A6ACCD;">docker rmi </span><span style="color:#82AAFF;">$</span><span style="color:#A6ACCD;">(docker images </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">q)                    </span><span style="color:#676E95;font-style:italic;">// 删除所有镜像</span></span>
<span class="line"></span></code></pre></div><p>2、容器操作</p><p><strong>创建容器</strong><br><code>docker create --name=nginx nginx</code></p><p><strong>交互型容器</strong><code>docker run --name centos -it centos /bin/bash</code></p><ul><li>i:打开容器的标准输入。</li><li>t:告诉 docker 为容器建立一个命令行终端。</li><li>name:指定容器名称，可以不填(随机)，建议根据具体使用功能命名，便于管理。</li><li>centos:告诉我们使用什么镜像来启动容器。</li><li>/bin/bash:告诉 docker 要在容器里面执行此命令。</li></ul><p><strong>后台型容器</strong></p><p>运行在后台，创建后与终端无关，只有调用 <code>docker stop</code>、<code>docker kill</code> 命令才能使容器停止</p><p><code>docker run --name nginx -d -p 8080:80 nginx</code></p><ul><li>--name 含义和上文一样，表示创建的容器的名字，</li><li>-d 表示容器在后台运行，</li><li>-p 表示将容器的 80 端口映射到宿主机的 8080 端口</li></ul><p><strong>相关命令：</strong></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">//进入容器</span></span>
<span class="line"><span style="color:#A6ACCD;">docker attach 容器名称</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">id</span><span style="color:#A6ACCD;"> (ps:exit</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">容器停止)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">docker exec </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">it 容器名称</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">id </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">bin</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">bash （</span><span style="color:#FFCB6B;">ps</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">exit</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">容器不会停止）</span></span>
<span class="line"><span style="color:#A6ACCD;">docker ps </span><span style="color:#676E95;font-style:italic;">//查看正在运行的容器</span></span>
<span class="line"><span style="color:#A6ACCD;">docker ps ‐a </span><span style="color:#676E95;font-style:italic;">//查看运行过的容器（历史）</span></span>
<span class="line"><span style="color:#A6ACCD;">docker ps ‐l </span><span style="color:#676E95;font-style:italic;">//最后一次运行的容器</span></span>
<span class="line"><span style="color:#A6ACCD;">docker start 容器名称</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">id </span><span style="color:#676E95;font-style:italic;">//启动容器</span></span>
<span class="line"><span style="color:#A6ACCD;">docker stop 容器名称</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">id </span><span style="color:#676E95;font-style:italic;">//停止容器</span></span>
<span class="line"><span style="color:#A6ACCD;">docker kill 容器名称</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">id </span><span style="color:#676E95;font-style:italic;">//强制停止容器</span></span>
<span class="line"><span style="color:#A6ACCD;">docker rm 容器名称</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">id </span><span style="color:#676E95;font-style:italic;">//删除容器</span></span>
<span class="line"><span style="color:#A6ACCD;">docker rm 容器名称</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">id 容器名称</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">id </span><span style="color:#676E95;font-style:italic;">//删除多个容器</span></span>
<span class="line"><span style="color:#A6ACCD;">docker rm </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">docker ps ‐a ‐q</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//删除所有容器</span></span>
<span class="line"><span style="color:#A6ACCD;">docker logs 容器名称</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">id </span><span style="color:#676E95;font-style:italic;">//查看容器日志</span></span>
<span class="line"><span style="color:#A6ACCD;">docker inspect 容器 ID</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">容器别名 </span><span style="color:#676E95;font-style:italic;">// 查看一个容器的详情</span></span>
<span class="line"><span style="color:#A6ACCD;">docker rename 原容器名 新容器名 </span><span style="color:#676E95;font-style:italic;">//重命名</span></span>
<span class="line"><span style="color:#A6ACCD;">ctrl </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> p </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> q </span><span style="color:#676E95;font-style:italic;">//退出容器回到宿主机</span></span>
<span class="line"></span></code></pre></div><p><strong>文件拷贝</strong></p><p>将文件拷贝到容器内：docker cp 需要拷贝的文件或目录 容器名称:容器目录<br><code>docker cp 1.txt c2:/root</code></p><p>将容器内文件拷贝到宿主机：docker cp 容器名称:容器目录 需要拷贝的文件或目录<br><code>docker cp c2:/root/1.txt /root</code></p><p><strong>目录挂载</strong></p><p>我们可以在创建容器的时候，将宿主机的目录与容器内的目录进行映射，这样我们就可 以通过修改宿主机某个目录的文件从而去影响容器。</p><p>创建容器 添加-v 参数 后边为 宿主机目录:容器目录</p><p><code>docker run ‐id ‐‐name=c4 ‐v /opt/:/usr/local/myhtml centos</code></p><p>如果你共享的是多级的目录，可能会出现权限不足的提示 <code>permission denied</code></p><p>这是因为 CentOS7 中的安全模块 selinux 把权限禁掉了，我们需要添加参数 <code>-- privileged=true</code> 来解决挂载的目录没有权限的问题</p><p><code>docker run ‐id ‐‐privileged=true ‐‐name=c4 ‐v /opt/:/usr/local/myhtml centos</code></p><h2 id="_4、镜像制作" tabindex="-1">4、镜像制作 <a class="header-anchor" href="#_4、镜像制作" aria-hidden="true">#</a></h2><p>docker 官方和个人发布的镜像由于版本等各种原因，漏洞较多，已统计 Docker Hub 超过 30%的官方镜像包含高危漏洞。此外，由于网络等原因也会造成 docker pull 下载镜像的 速度很慢。基于这种情况，我们可以手动定制 docker 系统镜像。</p><p>构建镜像的方式有两种：</p><ol><li>使用 docker commit 命令</li><li>Dockerfile 文件</li></ol><h3 id="_4-1-commit-制作镜像" tabindex="-1">4.1 commit 制作镜像 <a class="header-anchor" href="#_4-1-commit-制作镜像" aria-hidden="true">#</a></h3><p>拉取一个基础镜像<br><code>docker pull centos</code> 创建交互型容器<br><code>docker run ‐it ‐‐name=nodenv centos</code><br> 下载 node 文件，提示找不到 wget 命令，先安装 wget <code>yum -y install wget</code></p><p>打开容器<code>/opt/</code>目录，下载 node 源文件</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">tar </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">zxvf node</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v12</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">14.1</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">linux</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">x64</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tar</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">gz </span><span style="color:#676E95;font-style:italic;">//解压</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//配置软连接</span></span>
<span class="line"><span style="color:#A6ACCD;">ln </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> s </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> opt </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> node </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> bin </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> node </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> usr </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> local </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> bin </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> node</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">ln </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> s </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> opt </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> node </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> bin </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> npm </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> usr </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> local </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> bin </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> npm</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><code>node -v</code>可以看到当前容器安装的 <code>node</code>版本</p><p>将正在运行的容器提交为一个新的镜像 <code>docker commit nodenv nodenvi</code></p><p><code>docker images</code>就可以看到制作的镜像</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">[root@VM_0_11_centos </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">]# docker images</span></span>
<span class="line"><span style="color:#A6ACCD;">REPOSITORY TAG IMAGE ID CREATED SIZE</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx latest c7460dfcab50 </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;"> days ago 126MB</span></span>
<span class="line"><span style="color:#A6ACCD;">nodenvi latest 946e37cfe78b </span><span style="color:#F78C6C;">11</span><span style="color:#A6ACCD;"> days ago 333MB</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-2-dockerfile-文件制作镜像" tabindex="-1">4.2 Dockerfile 文件制作镜像 <a class="header-anchor" href="#_4-2-dockerfile-文件制作镜像" aria-hidden="true">#</a></h3><p>什么是 dockerfile?</p><p>Dockerfile 是一个包含用于组合映像的命令的文本文档。可以使用在命令行中调用任何命令。 Docker 通过读取 Dockerfile 中的指令自动生成映像。</p><p>docker build 命令用于从 Dockerfile 构建映像。可以在 docker build 命令中使用-f 标志指向文件系统中任何位置的 Dockerfile。</p><p>例：<code>docker build -f /path/to/a/Dockerfile</code></p><p><strong>Dockerfile 的基本结构:</strong></p><p>一般分为四部分：基础镜像信息、维护者信息、镜像操作指令和容器启动时执行指令，’#’ 为 Dockerfile 中的注释。</p><p>Dockerfile 文件说明:</p><p>Docker 以从上到下的顺序运行 Dockerfile 的指令。为了指定基本映像，第一条指令必须是 FROM。一个声明以＃字符开头则被视为注释。可以在 Docker 文件中使用 RUN，CMD，FROM，EXPOSE，ENV 等指令。 <img src="http://open.zantop.cn/911490-20171208222222062-849020400.png" alt=""></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">指定基础镜像，必须为第一个命令</span></span>
<span class="line"><span style="color:#A6ACCD;">格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 FROM </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">image</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 FROM </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">image</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">tag</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 FROM </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">@</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">digest</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 FROM mysql:5.6</span></span>
<span class="line"><span style="color:#A6ACCD;">注：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 tag 或 digest 是可选的，如果不使用这两个值时，会使用 latest 版本的基础镜像</span></span>
<span class="line"><span style="color:#A6ACCD;">MAINTAINER: 维护者信息</span></span>
<span class="line"><span style="color:#A6ACCD;"> 格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">MAINTAINER </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">MAINTAINER Jasper Xu</span></span>
<span class="line"><span style="color:#A6ACCD;">MAINTAINER sorex@163.com</span></span>
<span class="line"><span style="color:#A6ACCD;">MAINTAINER Jasper Xu &lt;sorex@163.com&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN:构建镜像时执行的命令</span></span>
<span class="line"><span style="color:#A6ACCD;"> RUN 用于在镜像容器中执行命令，其有以下两种命令执行方式：</span></span>
<span class="line"><span style="color:#A6ACCD;">shell 执行</span></span>
<span class="line"><span style="color:#A6ACCD;">格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">command</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">exec 执行</span></span>
<span class="line"><span style="color:#A6ACCD;">格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN apk update</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN [&quot;/etc/execfile&quot;, &quot;arg1&quot;, &quot;arg1&quot;]</span></span>
<span class="line"><span style="color:#A6ACCD;">注：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 RUN 指令创建的中间镜像会被缓存，并会在下次构建中使用。如果不想使用这些缓存镜像，可以在构建时指定--no-cache 参数，如：docker build --no-cache</span></span>
<span class="line"><span style="color:#A6ACCD;">ADD:将本地文件添加到容器中，tar 类型文件会自动解压(网络压缩资源不会被解压)，可以访问网络资源，类似 wget</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">ADD </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">src</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">... </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">dest</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">ADD [&quot;</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">src</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">&quot;,... &quot;</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">dest</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">&quot;] 用于支持包含空格的路径</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">ADD hom_ /mydir/ # 添加所有以&quot;hom&quot;开头的文件</span></span>
<span class="line"><span style="color:#A6ACCD;">ADD hom?.txt /mydir/ # ? 替代一个单字符,例如：&quot;home.txt&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">ADD test relativeDir/ # 添加 &quot;test&quot; 到 `WORKDIR`/relativeDir/</span></span>
<span class="line"><span style="color:#A6ACCD;">ADD test /absoluteDir/ # 添加 &quot;test&quot; 到 /absoluteDir/</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY:功能类似 ADD，但是是不会自动解压文件，也不能访问网络资源</span></span>
<span class="line"><span style="color:#A6ACCD;">CMD:构建容器后调用，也就是在容器启动时才进行调用。</span></span>
<span class="line"><span style="color:#A6ACCD;"> 格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;](执行可执行文件，优先)</span></span>
<span class="line"><span style="color:#A6ACCD;">CMD [&quot;param1&quot;,&quot;param2&quot;](设置了ENTRYPOINT，则直接调用ENTRYPOINT添加参数)</span></span>
<span class="line"><span style="color:#A6ACCD;">CMD command param1 param2 (执行 shell 内部命令)</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">CMD echo &quot;This is a test.&quot; | wc -</span></span>
<span class="line"><span style="color:#A6ACCD;">CMD [&quot;/usr/bin/wc&quot;,&quot;--help&quot;]</span></span>
<span class="line"><span style="color:#A6ACCD;">注：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 CMD 不同于 RUN，CMD 用于指定在容器启动时所要执行的命令，而 RUN 用于指定镜像构建时所要执行的命令。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">ENTRYPOINT:配置容器，使其可执行化。配合 CMD 可省去&quot;application&quot;，只使用参数。</span></span>
<span class="line"><span style="color:#A6ACCD;"> 格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;] (可执行文件, 优先)</span></span>
<span class="line"><span style="color:#A6ACCD;">ENTRYPOINT command param1 param2 (shell 内部命令)</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">FROM ubuntu</span></span>
<span class="line"><span style="color:#A6ACCD;">ENTRYPOINT [&quot;top&quot;, &quot;-b&quot;]</span></span>
<span class="line"><span style="color:#A6ACCD;">CMD [&quot;-c&quot;]</span></span>
<span class="line"><span style="color:#A6ACCD;">注：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　　 ENTRYPOINT 与 CMD 非常类似，不同的是通过 docker run 执行的命令不会覆盖 ENTRYPOINT，而 docker run 命令中指定的任何参数，都会被当做参数再次传递给 ENTRYPOINT。Dockerfile 中只允许有一个 ENTRYPOINT 命令，多指定时会覆盖前面的设置，而只执行最后的 ENTRYPOINT 指令。</span></span>
<span class="line"><span style="color:#A6ACCD;">LABEL:用于为镜像添加元数据</span></span>
<span class="line"><span style="color:#A6ACCD;"> 格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">LABEL </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> ...</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 LABEL version=&quot;1.0&quot; description=&quot;这是一个 Web 服务器&quot; by=&quot;IT 笔录&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">注：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　使用 LABEL 指定元数据时，一条 LABEL 指定可以指定一或多条元数据，指定多条元数据时不同元数据之间通过空格分隔。推荐将所有的元数据通过一条 LABEL 指令指定，以免生成过多的中间镜像。</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV:设置环境变量</span></span>
<span class="line"><span style="color:#A6ACCD;"> 格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> #</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">之后的所有内容均会被视为其</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">的组成部分，因此，一次只能设置一个变量</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> ... #可以设置多个变量，每个变量为一个&quot;</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">&quot;的键值对，如果</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">中包含空格，可以使用\来进行转义，也可以通过&quot;&quot;来进行标示；另外，反斜线也可以用于续行</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV myName John Doe</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV myDog Rex The Dog</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV myCat=fluffy</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPOSE:指定于外界交互的端口</span></span>
<span class="line"><span style="color:#A6ACCD;"> 格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPOSE </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">...]</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPOSE 80 443</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPOSE 8080</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPOSE 11211/tcp 11211/udp</span></span>
<span class="line"><span style="color:#A6ACCD;">注：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 EXPOSE 并不会让容器的端口访问到主机。要使其可访问，需要在 docker run 运行容器时通过-p 来发布这些端口，或通过-P 参数来发布 EXPOSE 导出的所有端口 \*/</span></span>
<span class="line"><span style="color:#A6ACCD;">VOLUME:用于指定持久化目录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> 格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">VOLUME [&quot;/path/to/dir&quot;]</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">VOLUME [&quot;/data&quot;]</span></span>
<span class="line"><span style="color:#A6ACCD;">VOLUME [&quot;/var/www&quot;, &quot;/var/log/apache2&quot;, &quot;/etc/apache2&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">注：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　一个卷可以存在于一个或多个容器的指定目录，该目录可以绕过联合文件系统，并具有以下功能：</span></span>
<span class="line"><span style="color:#A6ACCD;">卷可以容器间共享和重用</span></span>
<span class="line"><span style="color:#A6ACCD;">容器并不一定要和其它容器共享卷</span></span>
<span class="line"><span style="color:#A6ACCD;">修改卷后会立即生效</span></span>
<span class="line"><span style="color:#A6ACCD;">对卷的修改不会对镜像产生影响</span></span>
<span class="line"><span style="color:#A6ACCD;">卷会一直存在，直到没有任何容器在使用它</span></span>
<span class="line"><span style="color:#A6ACCD;">WORKDIR:工作目录，类似于 cd 命令</span></span>
<span class="line"><span style="color:#A6ACCD;"> 格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">WORKDIR /path/to/workdir</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">WORKDIR /a (这时工作目录为/a)</span></span>
<span class="line"><span style="color:#A6ACCD;">WORKDIR b (这时工作目录为/a/b)</span></span>
<span class="line"><span style="color:#A6ACCD;">WORKDIR c (这时工作目录为/a/b/c)</span></span>
<span class="line"><span style="color:#A6ACCD;">注：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　通过 WORKDIR 设置工作目录后，Dockerfile 中其后的命令 RUN、CMD、ENTRYPOINT、ADD、COPY 等命令都会在该目录下执行。在使用 docker run 运行容器时，可以通过-w 参数覆盖构建时所设置的工作目录。</span></span>
<span class="line"><span style="color:#A6ACCD;">USER:指定运行容器时的用户名或 UID，后续的 RUN 也会使用指定用户。使用 USER 指定用户时，可以使用用户名、UID 或 GID，或是两者的组合。当服务不需要管理员权限时，可以通过该命令指定运行用户。并且可以在之前创建所需要的用户</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">格式:</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 USER user</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 USER user:group</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 USER uid</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 USER uid:gid</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 USER user:gid</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 USER uid:group</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 USER www</span></span>
<span class="line"><span style="color:#A6ACCD;">注：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　使用 USER 指定用户后，Dockerfile 中其后的命令 RUN、CMD、ENTRYPOINT 都将使用该用户。镜像构建完成后，通过 docker run 运行容器时，可以通过-u 参数来覆盖所指定的用户。</span></span>
<span class="line"><span style="color:#A6ACCD;">ARG:用于指定传递给构建运行时的变量</span></span>
<span class="line"><span style="color:#A6ACCD;"> 格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">ARG </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">[=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">default</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">value</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">ARG site</span></span>
<span class="line"><span style="color:#A6ACCD;">ARG build_user=www</span></span>
<span class="line"><span style="color:#A6ACCD;">ONBUILD:用于设置镜像触发器</span></span>
<span class="line"><span style="color:#A6ACCD;"> 格式：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 ONBUILD [INSTRUCTION]</span></span>
<span class="line"><span style="color:#A6ACCD;">示例：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 ONBUILD ADD . /app/src</span></span>
<span class="line"><span style="color:#A6ACCD;">　　 ONBUILD RUN /usr/local/bin/python-build --dir /app/src</span></span>
<span class="line"><span style="color:#A6ACCD;">注：</span></span>
<span class="line"><span style="color:#A6ACCD;">　　当所构建的镜像被用做其它镜像的基础镜像，该镜像中的触发器将会被钥触发</span></span>
<span class="line"></span></code></pre></div><p><strong>示例结合 Jenkins 自动构建 node 项目：</strong></p><p>在 node 项目根目录下创建 Dockerfile 文件</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;"># Version </span><span style="color:#F78C6C;">1.0</span></span>
<span class="line"><span style="color:#A6ACCD;"># Base images 基础镜像</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">FROM </span><span style="color:#FFCB6B;">node</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">latest #维护者信息</span></span>
<span class="line"><span style="color:#A6ACCD;">MAINTAINER wz #相当于 cd 指定工作目录或者称当前目录，如果目录不存在，会自动建立</span></span>
<span class="line"><span style="color:#A6ACCD;">WORKDIR </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">home</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">nest</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">hello</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># 拷贝 package</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json 文件到工作目录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># </span><span style="color:#89DDFF;">!!</span><span style="color:#A6ACCD;">重要：package</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json 需要单独添加。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># Docker 在构建镜像的时候，是一层一层构建的，仅当这一层有变化时，重新构建对应的层。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># 如果 package</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json 和源代码一起添加到镜像，则每次修改源码都需要重新安装 npm 模块，这样木有必要。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># 所以，</span><span style="color:#FFCB6B;">正确的顺序是</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 添加 package</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json；安装 npm 模块；添加源代码。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">COPY </span><span style="color:#89DDFF;font-style:italic;">package</span><span style="color:#A6ACCD;">\</span><span style="color:#89DDFF;">*.</span><span style="color:#A6ACCD;">json </span><span style="color:#89DDFF;">./</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># 安装项目依赖</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">RUN npm install </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">registry</span><span style="color:#89DDFF;">=</span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//registry.npm.taobao.org</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># 将上下文里到项目文件拷贝到工作目录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">COPY </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">./</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># 暴露容器端口</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">EXPOSE </span><span style="color:#F78C6C;">3000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># 启动 node</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CMD npm run build </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> npm run </span><span style="color:#FFCB6B;">start</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">prod</span></span>
<span class="line"></span></code></pre></div><p>可以看到创建的<code>nest/hello</code>镜像</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">[root@VM_0_11_centos </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">]# docker images</span></span>
<span class="line"><span style="color:#A6ACCD;">REPOSITORY TAG IMAGE ID CREATED SIZE</span></span>
<span class="line"><span style="color:#A6ACCD;">nest</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">hello latest 50931be132fd </span><span style="color:#F78C6C;">31</span><span style="color:#A6ACCD;"> seconds ago 1</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">17GB</span></span>
<span class="line"></span></code></pre></div><p>创建 <code>setup.sh</code> 命令来创建容器并启动容器</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">#打开源代码目录</span></span>
<span class="line"><span style="color:#A6ACCD;">cd </span><span style="color:#89DDFF;">/</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;">/jenkins_home/workspace/node-nest-hello</span></span>
<span class="line"><span style="color:#A6ACCD;"># 停止之前的 docker container</span></span>
<span class="line"><span style="color:#A6ACCD;">docker stop nesthello #删除这个 container</span></span>
<span class="line"><span style="color:#A6ACCD;">docker rm nesthello</span></span>
<span class="line"><span style="color:#A6ACCD;"># 删除这个 container</span></span>
<span class="line"><span style="color:#A6ACCD;">docker rmi nest</span><span style="color:#89DDFF;">/</span><span style="color:#FFCB6B;">hello</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">latest</span></span>
<span class="line"><span style="color:#A6ACCD;"># 打包镜像</span></span>
<span class="line"><span style="color:#A6ACCD;">docker build </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">t nest</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">hello </span><span style="color:#89DDFF;">.</span></span>
<span class="line"><span style="color:#A6ACCD;"># 镜像目录</span></span>
<span class="line"><span style="color:#A6ACCD;">docker images</span></span>
<span class="line"><span style="color:#A6ACCD;"># 运行容器</span></span>
<span class="line"><span style="color:#A6ACCD;">docker run </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">d </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">u </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">privileged </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">restart always </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">name nesthello </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">p </span><span style="color:#F78C6C;">3004</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">3000</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;">/jenkins_home/workspace/node-nest-hello</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">home</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">node</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">node</span><span style="color:#A6ACCD;">-</span><span style="color:#FFCB6B;">nest</span><span style="color:#A6ACCD;">-</span><span style="color:#FFCB6B;">hello</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">nest</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">hello</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">latest</span></span>
<span class="line"><span style="color:#A6ACCD;"># 日志</span></span>
<span class="line"><span style="color:#A6ACCD;">docker logs nesthello</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>jenkins 对应配置 <img src="http://open.zantop.cn/Xnip2020-01-27_13-28-13.jpg" alt=""> 上传代码到仓库 Jenkins 自动构建，查看容器</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">[root@VM_0_11_centos </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">]# docker ps </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">a</span></span>
<span class="line"><span style="color:#A6ACCD;">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#A6ACCD;">65ea3ad81943 nest</span><span style="color:#89DDFF;">/</span><span style="color:#FFCB6B;">hello</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">latest </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">docker-entrypoint.s…</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> About a minute ago Up About a minute </span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0.0</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">3004</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#F78C6C;">3000</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">tcp nesthello</span></span>
<span class="line"></span></code></pre></div><p>浏览器输入<code>http://118.25.6.141:3004/</code>可以访问了</p><p><strong>↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</strong></p><h2 id="_5、jenkins-自动构建项目" tabindex="-1">5、jenkins 自动构建项目 <a class="header-anchor" href="#_5、jenkins-自动构建项目" aria-hidden="true">#</a></h2><p><img src="http://open.zantop.cn/docker20200120-225645@2x.png" alt=""></p><h3 id="_5-1-安装" tabindex="-1">5.1 安装 <a class="header-anchor" href="#_5-1-安装" aria-hidden="true">#</a></h3><p>查询 jenkins 镜像</p><p><code>docker search jenkins</code></p><p>拉取最新 jenkins</p><p><code>docker pull jenkins:latest</code></p><p>创建文件<code>/home/jenkins</code>,设置权限 <code>sudo chown 777 /home/jenkins</code></p><p>启动容器</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">docker run </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">d </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">u </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">privileged </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">name jenkins </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">p </span><span style="color:#F78C6C;">3002</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">8080</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">home</span><span style="color:#89DDFF;">/</span><span style="color:#FFCB6B;">jenkins</span><span style="color:#89DDFF;">:/</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;">/jenkins_home jenkins</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">latest</span></span>
<span class="line"></span></code></pre></div><ul><li>-u 0 指的是传入 root 账号 ID，覆盖容器中内置的账号</li><li>-v /home/jenkins:/var/jenkins_home 指的是将 docker 容器内的目录/var/jenkins_home 映射到宿主机/home/jenkins 目录上</li><li>--name jenkins 将容器命名为 jenkins</li><li>-p 3002:8080 端口映射，将容器的 8080 端口映射到宿主机的 49003 端口</li><li>--privileged 赋予最高权限</li></ul><p><strong>整条命令的意思:</strong><br> 运行一个镜像为 jenkins 的容器，命名为 jenkins，将容器的<code>/var/jenkins_home</code> 映射到宿主机的<code>/home/jenkins</code>目录下，映射容器中 8080 端口到宿主机 3002 端口</p><p><strong>查看 jenkins</strong></p><p>执行完成后，等待几十秒，等待 jenkins 容器启动初始化。 可以查看宿主机/home/jenkins 下是否多了很多文件 到浏览器中输入 localhost:3002 查看 jenkins 是否启动成功</p><p><strong>获取密码</strong></p><p><code>cat /home/jenkins/secrets/initialAdminPassword;</code></p><p>浏览器打开地址，输入密码进入，安装社区推荐插件。</p><h3 id="_5-2-配置-jenkins-ssh" tabindex="-1">5.2 配置 jenkins SSH <a class="header-anchor" href="#_5-2-配置-jenkins-ssh" aria-hidden="true">#</a></h3><p>这里的 SSH 是为容器配置的，可以让 jenkins 从 github 网站拉取代码</p><p>1、进入容器 jenkins 的内部</p><p><code>docker exec -it jenkins /bin/bash</code></p><p>2、生成 ssh 的密钥文件</p><p><code>ssh-keygen -t rsa -C &quot;wwww@163.com&quot; //连续按三次回车就好</code></p><p>3、退出容器复制 <code>/home/jenkins/.ssh/id_rsa.pub</code> 到主机目录下的<code>.ssh/authorized_keys</code> 中</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">exit </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> cd </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//退出容器</span></span>
<span class="line"><span style="color:#A6ACCD;">cd </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ssh </span><span style="color:#676E95;font-style:italic;">//进入根目录.ssh</span></span>
<span class="line"><span style="color:#A6ACCD;">cat </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">home</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">jenkins</span><span style="color:#89DDFF;">/.</span><span style="color:#A6ACCD;">ssh</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">id_rsa</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pub </span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> authorized_keys </span><span style="color:#676E95;font-style:italic;">//复制秘钥</span></span>
<span class="line"></span></code></pre></div><p>可以看到<code>authorized_keys</code>多了一个 ssh 秘钥</p><p>4、重启 SSH 服务</p><p><code>systemctl restart sshd.service</code></p><p>5、将公钥配置到你的 <code>github/gitlab</code> 的 <code>SSH setting</code>中</p><h3 id="_5-3-配置-jenkins-插件" tabindex="-1">5.3 配置 jenkins 插件 <a class="header-anchor" href="#_5-3-配置-jenkins-插件" aria-hidden="true">#</a></h3><p><strong>1、安装 Publish Over SSH 插件</strong></p><p>首页 -&gt; 点击系统管理 -&gt; 管理插件 -&gt;可选插件 -&gt; 过滤：ssh -&gt; 选择 Publish Over SSH 插件，点击直接安装</p><p><strong>2、配置 SSH</strong></p><p>系统管理 -&gt; 系统设置 -&gt; 下拉，找到 Publish over SSH</p><p>这里就是项目打包编译好后发送到哪个服务器的哪个目录</p><p>点击下测试，如果成功了就保存，错误一般是密码不对</p><p><strong>3、配置 node 插件</strong></p><p>因为我们的 node 项目需要 node 编译打包，所以安装下 node 插件 系统配置-插件管理-可选插件，搜索 nodejs，直接安装</p><p>然后去系统配置-全局工具管理-nodejs，配置几个你要用到的 node 版本</p><p>如果看到此错误，进入 jenkins 容器 检查是否安装了 git</p><p><code>git --version</code><br><code>which git</code> //如果安装查看路径，在上面错误路径中输入此路径 如果没有安装 git,在 jenkins 中 安装 git</p><h3 id="_5-4-安装-nginx" tabindex="-1">5.4 安装 nginx <a class="header-anchor" href="#_5-4-安装-nginx" aria-hidden="true">#</a></h3><p>docker 安装 nginx</p><p><code>docker pull nginx</code></p><p>启动 nginx 容器</p><p><code>docker run -d -p 3003:80 --name nginx nginx</code></p><p>挂载配置文件</p><p>因为第二步运行的 Nginx 的配置文件是在容器内部的，不方便修改，所以我们可以先把容器内的配置文件复制到宿主机</p><p>创建 nginx 工作目录</p><p><code>mkdir -p var/nginx/conf var/nginx/www var/nginx/logs</code></p><p>拷贝 docker 配置文件到宿主机工作目录</p><p><code>docker cp -a nginx:/etc/nginx/nginx.conf /var/nginx/conf</code></p><p>重启 nginx 容器</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">//首先停止之前的容器并删除</span></span>
<span class="line"><span style="color:#A6ACCD;">docker stop nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">docker rm nginx</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//重新启动容器并挂载工作目录</span></span>
<span class="line"><span style="color:#A6ACCD;">docker run </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">d </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">restart always </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">p </span><span style="color:#F78C6C;">3003</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;">/nginx/www</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">usr</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">share</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">html</span><span style="color:#A6ACCD;"> -</span><span style="color:#FFCB6B;">v</span><span style="color:#A6ACCD;"> /</span><span style="color:#FFCB6B;">var</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">conf</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">nginx</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">conf</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">etc</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">nginx</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">conf</span><span style="color:#A6ACCD;"> -</span><span style="color:#FFCB6B;">v</span><span style="color:#A6ACCD;"> /</span><span style="color:#FFCB6B;">var</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">logs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">var</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">log</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;"> --</span><span style="color:#FFCB6B;">name</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">restart always </span><span style="color:#676E95;font-style:italic;">// 表示 docker 重启时会自动重启该容器</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;">/nginx/www</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">usr</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">share</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">html</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 映射容器默认静态页面路径</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;">/nginx/conf/nginx.conf</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">etc</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">nginx</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">conf</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 映射容器配置文件</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;">/nginx/logs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">var</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">log</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 映射容器日志目录</span></span>
<span class="line"></span></code></pre></div><p>再去访问你的服务器 ip 发现 403,是因为 www 目录无内容，去新建一个 index.html 看下</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// cd /var/nginx/www</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//touch index.html</span></span>
<span class="line"><span style="color:#A6ACCD;">inde</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">html 里内容如下：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#A6ACCD;">DOCTYPE html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">en</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">viewport</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width=device-width, initial-scale=1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">http-equiv</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">X-UA-Compatible</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ie=edge</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Document</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">海上生明月，天涯共此时。</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">// 发现再去访问就能看到这个页面了</span></span>
<span class="line"></span></code></pre></div><h3 id="_5-5-构建-web-项目" tabindex="-1">5.5 构建 web 项目 <a class="header-anchor" href="#_5-5-构建-web-项目" aria-hidden="true">#</a></h3><p>1、新建任务-填写任务名称-构建一个自由风格的软件项目</p><p>2、源码管理 前边第四步已经配置过 SSH，这里可以使用 SSH 协议的 git 项目地址 出现上图报错，检查 jenkins 容器内是否安装了 git 或者版本是否过低，进入到 jenkins 容器内，查看 git 版本</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">[root@iZgm2xqy8dx52vZ </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">]# docker exec </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">it jenkins </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">bin</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">bash</span></span>
<span class="line"><span style="color:#A6ACCD;">jenkins@8</span><span style="color:#FFCB6B;">f133f801f50</span><span style="color:#89DDFF;">:/</span><span style="color:#A6ACCD;">$   git </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">version     </span><span style="color:#676E95;font-style:italic;">// jenkins@8f133f801f50:/$代表在 jenkins 容器内</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">11.0</span></span>
<span class="line"></span></code></pre></div><p><img src="http://open.zantop.cn/blog20200117-163824@2x.png" alt=""> 如果没有安装，去系统配置-全局工具配置-git，勾选自动安装试试，另外可 如果 git 版本过低，可以试试下面 jenkins 中安装/卸载/重装 git 的操作。 <img src="http://open.zantop.cn/blog20201171633.png" alt=""> 如果容器的 git 没问题，ssh 也配置过，还是报错的话，就把项目 git 地址换成 https 的，没有问题就再切回 ssh 协议的。 如果还有问题！！！ <img src="http://open.zantop.cn/blog20200117-165649@2x.png" alt=""> 然后发现，呦吼，终于可以了！</p><p>3、构建环境</p><p>选择你配置的 node 插件 <img src="http://open.zantop.cn/blog20200117-164040@2x.png" alt=""> 4、构建</p><p>web 项目，删除依赖-重新安装依赖-打包编译-压缩 <img src="http://open.zantop.cn/blog20200117-164154@2x.png" alt=""> 5、构建后操作</p><p>打包编译后发送到要部署的服务上，最终的传输路径为 SSH 服务器的 Remote directory+这里的 Remote directory，比如我前边配置的是根目录/，这里是/home/umiPc, 所以 最终发送的路径为：要部署的 SSH 服务器的/home/umiPc，可以去该服务器的目录中查看一下。 <img src="http://open.zantop.cn/blog20200117-165649@2x.png" alt=""> 6、执行构建操作</p><p>文件权限不足，解决方法如下：</p><p><code>chmod -R 777 /var/jenkins_home/workspace</code></p><p>node 版本不合适，切换其他版本</p><p>构建失败，拉取项目超时</p><p><code>ERROR: Timeout after 10 minutes ERROR: Error cloning remote repo &#39;origin&#39;</code></p><p>可以去如下设置超时时间和拉取代码配置 <img src="http://open.zantop.cn/blog20200117-170832@2x.png" alt=""> 点击立即构建，等一会，不出意外的话，项目构建成功。 构建细节我们可以观察本次构建的控制台输出( Console Output) 来观察项目的执行过程。 这里构建可能失败，这里记录几种常见错误：</p><p>7、自动构建</p><p>代码 push 到 git 仓库，自动构建，以 gitee 为例子</p><p>jenkins gitee 自动构建配置</p><p><a href="https://juejin.im/post/5e0ad7a06fb9a0482c4e9d22#heading-40" target="_blank" rel="noreferrer">docker + jenkins 部署完整 node 项目</a></p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-c5936a1e data-v-e033cd21><div class="edit-info" data-v-e033cd21><!----><div class="last-updated" data-v-e033cd21><p class="VPLastUpdated" data-v-e033cd21 data-v-355aa5ef>最后更新: <time datetime="2023-01-11T06:13:27.000Z" data-v-355aa5ef></time></p></div></div><div class="prev-next" data-v-e033cd21><div class="pager" data-v-e033cd21><a class="pager-link prev" href="/end/os/centos%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93" data-v-e033cd21><span class="desc" data-v-e033cd21>上一页</span><span class="title" data-v-e033cd21>centos问题总结</span></a></div><div class="has-prev pager" data-v-e033cd21><a class="pager-link next" href="/end/os/Linux%E4%B8%8B%E5%AE%89%E8%A3%85Git" data-v-e033cd21><span class="desc" data-v-e033cd21>下一页</span><span class="title" data-v-e033cd21>Linux下安装Git</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"end_index.md\":\"6d3badb2\",\"end_database_mongodb备份与恢复.md\":\"6aa56e9b\",\"end_node_nodebb搭建论坛.md\":\"61501807\",\"end_node_nvm管理多版本node.md\":\"78365974\",\"end_node_nodejs爬虫彩票数据.md\":\"9b91cb59\",\"end_node_定时任务.md\":\"6427b8d8\",\"end_node_pm2命令.md\":\"08ab0cef\",\"end_os_centos操作.md\":\"7717c3c1\",\"end_os_centos问题总结.md\":\"6ebfc266\",\"end_os_mac与vim日常命令.md\":\"44117832\",\"end_node_微信小程序模板消息.md\":\"2bc465c4\",\"end_os_linux下安装git.md\":\"7a9e46ba\",\"end_node_配置ssh连接服务器.md\":\"7fcbbdab\",\"end_os_mac相关.md\":\"5cb9be12\",\"end_os_linux和centos中chmod命令.md\":\"7d6dae40\",\"end_node_node搭建cli.md\":\"469aded3\",\"end_node_egg.js笔记.md\":\"54661091\",\"frame_flutter_基础.md\":\"5c4dd8ae\",\"end_node_腾讯云服务器部署nodejs项目.md\":\"3fc05081\",\"end_os_docker虚拟化技术.md\":\"30da5c24\",\"end_os_ngnix配置记录.md\":\"5a3e76c4\",\"end_node_微信小程序支付.md\":\"413ecebc\",\"end_database_mongoose.md\":\"7629b095\",\"frame_react_redux-saga解析.md\":\"c23b6268\",\"frame_react_hooks.md\":\"82158d23\",\"frame_react_redux-thunk解析.md\":\"7b79f281\",\"frame_react_事件传参.md\":\"cfdd3a67\",\"end_node_nestjs实践教程.md\":\"c1d0559f\",\"frame_react_redux的应用.md\":\"35a44e51\",\"frame_react_redux的实现.md\":\"c2739528\",\"front_css_flex布局.md\":\"41d91804\",\"front_eng_nrm 使用.md\":\"895e41af\",\"front_eng_npm相关.md\":\"6f1feaaa\",\"front_css_移动端适配解决方案.md\":\"80b18127\",\"front_eng_git缩写命令.md\":\"88d3186f\",\"front_eng_packagejson详解.md\":\"cbaffbf1\",\"front_eng_git配置多个ssh.md\":\"c7d76292\",\"front_eng_git自动化部署项目.md\":\"a7be5f2b\",\"front_eng_git提交规范.md\":\"ea479f1d\",\"frame_vue_vuex状态管理.md\":\"a8edc85a\",\"front_js_作用域.md\":\"dd51a738\",\"front_eng_设计颜色值.md\":\"cc33e19d\",\"front_eng_搭建npm私仓库.md\":\"3bc566af\",\"front_interview_汇总.md\":\"b49716f0\",\"front_eng_基于lerna管理packages.md\":\"a9977395\",\"front_eng_tsrollup搭建工具库.md\":\"2799b4c4\",\"front_js_函数节流和防抖.md\":\"33fef6e1\",\"front_js_字符串方法.md\":\"dfbd5d55\",\"front_ts_初识篇.md\":\"7a49eecf\",\"front_ts_基础篇-三斜线指令.md\":\"29ace878\",\"front_ts_基础篇-声明合并.md\":\"83f91b91\",\"front_js_浏览器工作原理和v8引擎.md\":\"5c04b64e\",\"front_eng_代码规范配置.md\":\"ae82caab\",\"front_ts_基础篇-声明文件.md\":\"42c52f50\",\"front_ts_基础篇-函数.md\":\"6a4cf3dc\",\"front_ts_基础篇-接口.md\":\"015a7628\",\"front_ts_基础篇-模块和命名空间.md\":\"062003a3\",\"front_ts_基础篇-数据类型.md\":\"1f655db7\",\"front_ts_基础篇-泛型.md\":\"844e8dc6\",\"front_ts_实战篇react环境搭建.md\":\"0da7f426\",\"front_ts_实战篇ts-eslint.md\":\"66523c17\",\"front_ts_实战篇react与组件类型.md\":\"0a7a0d51\",\"front_ts_基础篇-类.md\":\"cd3093ea\",\"front_ts_进阶篇-工具函数库.md\":\"7d7cbccc\",\"front_ts_文章.md\":\"459bff2f\",\"front_ts_基础篇-装饰器.md\":\"431dc953\",\"front_ts_实战篇vue环境搭建.md\":\"e3281580\",\"front_js_数组方法.md\":\"004e88fc\",\"front_ts_工程篇.md\":\"3fd19913\",\"front_ts_基础篇-高级类型.md\":\"dccc20ef\",\"my_关于.md\":\"1f141f2e\",\"front_ts_实战篇vue与组件类型.md\":\"e7f7fa7c\",\"read_10人以下小团队管理手册.md\":\"670f93fc\",\"index.md\":\"fc06fb6b\",\"read_别让猴子跳回背上.md\":\"f236ea8f\",\"read_技术人的管理之路.md\":\"cf8b24ac\",\"my_进阶要求.md\":\"159b242c\",\"read_穷爸爸富爸爸.md\":\"a6450039\",\"read_职场沟通12讲.md\":\"6578cb6f\",\"site_收藏.md\":\"0cfba0f4\",\"read_结构化思维.md\":\"86fac5ab\",\"site_常用.md\":\"988b45f1\",\"read_技术管理36讲.md\":\"1bb0dedc\",\"front_ts_配置篇.md\":\"d1d546da\"}")</script>
    <script type="module" async src="/assets/app.c4aa1f4f.js"></script>
    
  </body>
</html>